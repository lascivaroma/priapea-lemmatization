
Poems = {
34: """Cum sacrum fieret deo salaci,
conducta est pretio puella paruo
communis satis omnibus futura,
quae quot nocte uiros peregit una,
tot uerpas tibi dedicat salignas.""", 
35: """Pedicabere, fur, semel; sed idem
si praedatus eris bis, irrumabo.
et si tertia furta molieris,
ut poenam patiare et hanc et illam,
pedicaberis irrumaberisque.""",
36: """Notas habemus quisque corporis formas:
Phoebus comosus, Hercules lacertosus,
trahit figuram uirginis tener Bacchus,
Minerua rauo lumine est, Venus paeto,
Frontem caprinos Arcadas uides Faunos,
habet decentes nuntius deum plantas,
tutela Lemni dispares mouet gressus,
intonsa semper Aesculapio barba est,
nemo est feroci pectorosior Marte:
quod si quis inter hos locus mihi restat,
deus Priapo mentulatior non est.""",
37: """Cur pictum memori sit in tabella
membrum, quaeritis, unde procreamur?
cum penis mihi forte laesus esset
chirurgique manum miser timerem,
dis me legitimis nimisque magnis,
ut Phoebo puta filioque Phoebi,
Curandam dare mentulam uerebar.
huic dixi: 'fer opem, Priape, parti,
cuius tu, pater, ipse pars uideris,
qua salua sine sectione facta
ponetur tibi picta, quam leuaris,
Par uel consimilisque concolorque.'
promisit fore mentulamque mouit
pro nutu deus et rogata fecit.""",
38: """Simpliciter tibi me, quodcumque est, dicere oportet,
Natura est quoniam semper aperta mihi:
Pedicare uolo; tu uis decerpere poma;
Quod peto, si dederis, quod petis, accipies.""",
39: """Forma Mercurius potest placere,
forma conspiciendus est Apollo,
formosus quoque pingitur Lyaeus,
formosissimus omnium est Cupido.
me pulcra fateor carere forma,
uerum mentula luculenta nostra est:
hanc mauult sibi quam deos priores,
si qua est non fatui puella cunni.""",
40 : """Nota Suburanas inter Telethusa puellas,
quae, puto, de quaestu libera facta suo est,
cingit inaurata penem tibi, sancte, corona:
hunc pathicae summi numinis instar habent.""",
41: """Quisquis uenerit huc, poeta fiat
et uersus mihi dedicet iocosos.
qui non fecerit, inter eruditos
ficosissimus ambulet poetas.""",
42: """Laetus Aristagoras natis bene uilicus uuis
de cera ficta dat tibi poma, deus.
at tu sacrati contentus imagine pomi
fac ueros fructus ille, Priape, ferat.""",
43: """uelle quid hanc dicas, quamuis sim ligneus, hastam,
oscula dat medio si qua puella mihi?
augure non opus est: 'in me' (mihi credite), dixit
'Utetur ueris usibus hasta rudis'.""",
44:"""Nolite omnia, quae loquor, putare
per lusum mihi per iocumque dici.
deprensos ego ter quaterque fures
omnes, ne dubitetis, irrumabo.""",
45: """Cum quendam rigidus deus uideret
feruenti caput ustulare ferro,
ut Maurae similis foret puellae,
'heus' inquit 'tibi dicimus, cinaede,
uras te licet usque torqueasque,
num tandem prior es puella, quaeso,
Quam sunt, mentula quos habet, capilli?'""",
46: """O non candidior puella Mauro,
sed morbosior omnibus cinaedis,
Pygmaeo breuior gruem timenti,
ursis asperior pilosiorque,
Medis laxior Indicisue bracis,
Manes hinc licet ut libenter ires
nam quamuis uidear satis paratus,
erucarum opus est decem maniplis,
fossas inguinis ut teram dolemque
cunni uermiculos scaturrientis.""",
47: """Quicumque uestrum, qui uenitis ad cenam,
libare nullos sustinet mihi uersus,
illius uxor aut amica riualem
lasciuiendo languidum, precor, reddat,
et ipse longa nocte dormiat solus
libidinosis incitatus erucis.""",
48: """Quod partem madidam mei uidetis,
per quam significor Priapus esse,
non ros est, mihi crede, nec pruina,
sed quod sponte sua solet remitti,
cum mens est pathicae memor puellae.
""",
49: """Tu, quicumque uides circa tectoria nostra
non nimium casti carmina plena ioci,
uersibus obscenis offendi desine: non est
mentula subducti nostra supercilii.""", 
50: """Quaedam, si placet hoc tibi, Priape,
fucosissima me puella ludit
et nec dat mihi nec negat daturam,
causas inuenit usque differendi.
quae si contigerit fruenda nobis,
totam comparibus, Priape, nostris
cingemus tibi mentulam coronis.""",
51: """Quid hoc negoti est quaue suspicer causa
uenire in hortum plurimos meum fures,
cum, quisquis in nos incidit, luat poenas
et usque curuos excauetur ad lumbos?
non ficus hic est praeferenda uicinae
uuaeque, quales flaua legit Arete,
non mala truncis adserenda Picenis
pirumue, tanto quod periculo captes,
magisque cera luteum noua prunum
sorbumue uentres lubricos moraturum.
praesigne rami nec mei ferunt morum
nucemue longam, quae uocatur Albana,
amygdalumue flore purpureo fulgens.
non brassicarum ferre glorior caules
betasue, quantas hortus educat nullus,
crescensue semper in suum caput porrum.
nec seminosas ad cucurbitas quemquam
ad ocimumue cucumeresque humi fusos
uenire credo, sessilesue lactucas
acresque cepas aliumque furatum,
nec ut salaces nocte tollat erucas
mentamque olentem cum salubribus rutis.
quae cuncta quamuis nostro habemus in saepto,
non pauciora proximi ferunt horti.
quibus relictis in mihi laboratum
locum uenitis, improbissimi fures:
nimirum apertam conuolatis ad poenam,
et uos et ipsum, quod minamur, inuitat.""",
52: """Heus tu, non bene qui manum rapacem
mandato mihi contines ab horto,
iam primum stator hic libidinosus
alternis et eundo et exeundo
porta te faciet patentiorem.
accedent duo, qui latus tuentur,
pulchre pensilibus peculiati;
qui cum te male foderint iacentem,
ad partes ueniet salax asellus
et nil deterius mutuniatus.
quare, qui sapiet, malus cauebit,
cum tantum sciat esse mentularum.""",
53: """Contentus modico Bacchus solet esse racemo,
cum capiant alti uix cita musta lacus,
magnaque fecundis cum messibus area desit,
in Cereris crines una corona datur.
tu quoque, diue minor, maiorum exempla secutus,
quamuis pauca damus, consule poma boni.
""",
54: """CD si scribas temonemque insuper addas,
qui medium uult te scindere, pictus erit""",
55: """Credere quis possit? falcem quoque - turpe fateri -
de digitis fures subripuere meis.
nec mouet amissi tam me iactura pudorque,
quam praebent iustos altera tela metus:
quae si perdidero, patria mutabor, et olim
ille tuus ciuis, Lampsace, Gallus ero.""",
56: """Derides quoque, fur, et impudicum
ostendis digitum mihi minanti?
eheu me miserum, quod ista lignum est,
quae me terribilem facit uideri.
mandabo domino tamen salaci,
ut pro me uelit irrumare fures.""",
57: """Cornix et caries uetusque bustum,
turba putida facta saeculorum,
quae forsan potuisset esse nutrix
Tithoni Priamique Nestorisque,
illis ni pueris anus fuisset,
ne desit sibi, me rogat, fututor.
quid si nunc roget, ut puella fiat?
si nummos tamen haec habet, puella est.""",
58: """Quicumque nostram fur fefellerit curam,
effeminato uerminet procul culo;
quaeque hic proterua carpserit manu poma
puella, nullum reperiat fututorem.""",
59: """Praedictum tibi ne negare possis:
si fur ueneris, inpudicus exis.""",
60: """Si quot habes uersus, tot haberes poma, Priape,
esses antiquo ditior Alcinoo.""",
61: """Quid frustra quereris, colone, mecum,
Quod quondam bene fructuosa malus
Autumnis sterilis duobus adstem?
Non me praegravat, ut putas senectus,
Nec sum grandine verberata dura,
Nec gemmas modo germine exeuntes
Seri frigoris ustulavit aura,
Nec venti pluviaeve siccitasve,
Quod de se quererer, malum dederunt;
Non sturnus mihi graculusve raptor
Aut cornix anus aut aquosus anser
Aut corvus nocuit siticulosus:
Sed quod carmina pessimi poetae
Ramis sustineo laboriosis.""",
62: """Securi dormite, canes: custodiet hortum
cum sibi dilecta Sirius Erigone.""",
63: """Parum est quod, hic ut fiximus semel sedem,
agente terra per caniculam rimas
siticulosam sustinemus aestatem;
parum, quod imos perfluunt sinus imbres
et in capillos grandines cadunt nostros
rigetque dura barba uincta crystallo;
parum, quod acta sub laboribus luce
parem diebus peruigil traho noctem.
huc adde, quod me fuste de rudi uilem
manus sine arte rusticae dolauerunt,
interque cunctos ultimum deos numen
cucurbitarum ligneus uocor custos.
accedit istis impudentiae signum,
libidinoso tenta pyramis neruo.
ad hoc puella — paene nomen adieci —
solet uenire cum suo fututore,
quae tot figuras, quot Philaenis enarrat,
Commenta bis, pruriginosa discedit.""",
64: """Quidam mollior anseris medulla
Furatum uenit huc amore poenae:
Furetur licet usque, non uidebo.""",
65: """Hic tibi qui rostro crescentia lilia morsit,
caeditur e tepida uictima porcus hara:
ne tamen exanimum facias pecus omne, Priape,
horti sit, facias, ianua clausa tui.""",
66: """Tu, quae ne uideas notam uirilem,
hinc auerteris, ut decet pudicam:
nimirum, nisi quod times uideri,
intra uiscera habere concupiscis.""",
67: """Penelopes primam Didonis prima sequatur
et primam Cadmi syllaba prima Remi,
quodque fit ex illis, mihi tu deprensus in horto,
fur, dabis: hac poena culpa luenda tua est.""",
68: """Rusticus indocte si quid dixisse uidebor,
da ueniam: libros non lego, poma lego.
sed rudis hic dominum totiens audire legentem
cogor Homeriacas edidicique notas.
ille uocat, quod nos psolen, Ψολόεντα κεραυνόν,
et quod nos culum, κουλεόν ille uocat.
Μερδαλέον certe quasi res non munda uocatur,
et pediconum mentula merdalea est.
Qui, nisi Taenario placuisset Troica cunno
mentula, quod caneret, non habuisset opus.
mentula Tantalidae bene si non mota fuisset,
nil, senior Chryses quod quereretur, erat.
haec eadem socium tenera spoliauit amica,
quaeque erat Aeacidae, maluit esse suam.
ille Pelethroniam cecinit miserabile carmen
ad citharam, cithara tensior ipse sua.
nobilis hinc nata nempe incipit Ilias ira:
principium sacri carminis fuit.
altera materia est error fallentis Ulixei;
si uerum quaeras, hunc quoque mouit amor.
hic legitur radix, de qua flos aureus exit,
quam cum μῶλυ uocat, mentula μῶλυ fuit.
hic legimus Circen Atlantiademque Calypson
grandia Dulichii uasa petisse uiri.
huius et Alcinoi mirata est filia membrum
frondenti ramo uix potuisse tegi.
ad uetulam tamen ille suam properabat, et omnis
mens erat in cunno, Penelopea, tuo:
quae sic casta manes, ut iam conuiuia uisas
utque fututorum sit tua plena domus.
e quibus ut scires quicumque ualentior esset,
haec es ad arrectos uerba locuta procos:
'nemo meo melius neruum tendebat Ulixe,
siue illi laterum siue erat artis opus.
qui quoniam periit, uos nunc intendite, quemquem
esse uirum sciero, uir sit ut ille meus.'
hac ego, Penelope, potui tibi lege placere,
illo sed nondum tempore natus eram.""",
69: """Cum fici tibi suauitas subibit
et iam porrigere huc manum libebit,
ad me respice, fur, et aestimato,
quot pondo est tibi mentulam cacandum.""",
70: """Illusit mihi pauper inquilinus:
cum ferctum dederat molamque tusam,
quorum partibus additis in inguen,
sacro protinus hinc abit peracto.
uicini canis huc subinde uenit
nidorem, puto, persecuta fumi,
quae libamine mentulae comeso
tota nocte mihi litat rigando.
at uos amplius hoc loco cauete
quicquam ponere ne famelicarum
ad me turba uelit canum uenire,
ne dum me colitis meumque numen,
custodes habeatis irrumatos.""",
71: """Si commissa meae carpes pomaria curae,
dulcia quid doleam perdere, doctus eris.""",
72: """Tutelam pomarii, diligens Priape, facito:
rubricato furibus minare mutinio.
Quod mouear, non est, quia, si furaberis ipse
grandia mala, tibi brachia macra dabo.""",
73: """Obliquis quid me, pathicae, spectatis ocellis?
non stat in inguinibus mentula tenta meis.
quae tamen exanimis nunc est et inutile lignum,
utilis haec, aram si dederitis, erit.""",
74: """Per medios ibit pueros mediasque puellas
Mentula , barbatis non nisi summa petet .""",
75: """Dodone tibi, Iuppiter, sacrata est,
Iunoni Samos et Mycena ditis,
undae Taenaros aequorumque regi;
Pallas Cecropias tuetur arces,
Delphos Pythius, orbis umbilicum,
Creten Delia Cynthiosque colles,
Faunus Maenalon Arcadumque siluas;
tutela Rhodos est beata Solis,
Gades Herculis umidumque Tibur;
Cyllene celeri deo niuosa,
tardo gratior aestuosa Lemnos;
Hennaeae Cererem nurus frequentant,
raptam Cyzicos ostreosa diuam,
formosam uenerem Gnidos Paphosque;
mortales tibi Lampsacum dicarunt.
Quod sim iam senior meumque canis
Cum barba caput albicet capillis:
Deprensos ego perforare possum
Tithonum Priamumque Nestoremque."""

}

import lxml.etree as ET
import re

def get_line(parent):
	return ET.SubElement(parent, "l")

with open("priapea.xml") as f:
	xml = ET.parse(f)
	for ab_no, ab in enumerate(xml.xpath(".//tei:ab", namespaces={"tei": "http://www.tei-c.org/ns/1.0"})):
		real_id = ab_no + 1

		if real_id in Poems:

			poem = Poems[real_id].split("\n")
			# Remove first line
			poem.pop(0)
			# Get words
			words = ab.xpath(".//tei:w", namespaces={"tei": "http://www.tei-c.org/ns/1.0"})
			# Create a new line
			l = get_line(ab)
			next_line = poem.pop(0)
			while words:
				cur_word = words.pop(0)
				try:
					if next_line  and cur_word.attrib["pos"] != "PUNC" and re.match("\W*\s*"+cur_word.text.strip()+".*", next_line.strip(), flags=re.IGNORECASE):
						l = get_line(ab)
						if poem:
							next_line = poem.pop(0)
						else:
							next_line = None
				except Exception as E:
					print(ET.tostring(cur_word), poem, words)
					raise E
				l.append(cur_word)

with open("aligned.xml", "w") as f:
	f.write(ET.tostring(xml, encoding=str))